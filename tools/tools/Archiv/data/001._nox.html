<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nox</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Nastaven√≠ fontu Inter pro celou str√°nku, aby to vypadalo modernƒõ a ƒçitelnƒõ */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Styly pro mod√°ln√≠ okna */
        .modal {
            background: #111;
            border: 2px solid #facc15;
            padding: 2rem;
            border-radius: 10px;
            color: #fff;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .modal h3 {
            color: #facc15;
            margin-top: 0;
            text-align: center;
        }
        .modal button {
            margin-top: 1rem;
            width: auto;
            display: inline-block;
        }
        .modal-text {
            color: #ccc;
            margin-bottom: 1rem;
        }
        .modal-buttons {
            text-align: right;
            width: 100%;
        }
        .sickness-text {
            color: #F87171;
            font-weight: bold;
        }
        .poison-text {
            color: #A348A3;
            font-weight: bold;
        }
        .task-container {
            background-color: #facc15;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1rem;
            color: #000;
        }
        .job-item {
            background-color: #f0f0f0;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 0.5rem;
        }
        .job-item h4 {
            font-weight: bold;
            color: #111;
            font-size: 1.1rem;
        }
        .job-item p {
            color: #444;
        }
        /* Nav√≠c styl pro tlaƒç√≠tko Zpƒõt na Dashboard */
        .back-to-dashboard-link {
            display: block;
            width: fit-content;
            background-color: #4a4a4a;
            color: #fff;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: bold;
            margin-bottom: 1.5rem;
            transition: background-color 0.2s ease;
            position: absolute;
            top: 1rem;
            left: 1rem;
            z-index: 100;
        }
        .back-to-dashboard-link:hover {
            background-color: #6a6a6a;
        }
        .back-to-dashboard-link:focus {
            outline: 2px solid #facc15;
            outline-offset: 2px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-indigo-900 to-black min-h-screen flex items-center justify-center p-4">
    <a href="../index.html" class="back-to-dashboard-link" aria-label="Zpƒõt na hlavn√≠ dashboard Palpatius games" role="button">‚Üê Zpƒõt na Palpatius games</a>

    <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-4xl w-full text-center space-y-6">
        <h1 class="text-4xl font-extrabold text-gray-800 mb-4">Nox</h1>

        <div id="introScreen" class="hidden">
            <p class="text-gray-700 text-base leading-relaxed text-left">
                Vrac√≠m se dom≈Ø, unaven√Ω jako pes po dlouh√©m dni. U≈æ skoro otv√≠r√°m dve≈ôe od domu, kdy≈æ mƒõ nƒõco donut√≠ zastavit se. Nƒõco sed√≠ p≈ô√≠mo na prahu. Mal√©, chlupat√©, a √∫plnƒõ absurdn√≠ stvo≈ôen√≠.
                P≈ôikrƒç√≠m se, abych si ho po≈ô√°dnƒõ prohl√©dl. M√° ƒçernou  srst, kter√° se v ≈°eru m√≠s√≠ s okol√≠m. M√° lehce prot√°hl√Ω ƒçum√°ƒçek, a titƒõrn√© r≈Ø≈æky na hlavƒõ. Vypad√° jako pes, ale ne tak √∫plnƒõ. D√≠v√° se na mƒõ. Tƒõma nejstar≈°√≠ma, nejhlub≈°√≠ma oƒçima, co jsem kdy vidƒõl. 
                ‚ÄûKdo jsi, maliƒçk√Ω?‚Äú zept√°m se ≈°eptem, opatrnƒõ k nƒõmu vzt√°hnu ruku. Pomalu se nat√°hnu a pohlad√≠m ho. Jeho srst je neuvƒõ≈ôitelnƒõ hladk√°, jako ta nejjemnƒõj≈°√≠ l√°tka. V tu chv√≠li mi hlavou probleskne jedno jedin√© slovo, jasn√© jako zvon: ‚ÄûNox.‚Äú
                ‚ÄûTak≈æe ty jsi Nox?‚Äú zopakuju p≈ôekvapenƒõ, zat√≠mco d√°l hlad√≠m to z√°zraƒçn√© stvo≈ôen√≠. D√≠v√° se na mƒõ, a najednou, jako by mi nƒõkdo otev≈ôel okno do jin√© dimenze, v√≠m v≈°echno. V√≠m, ≈æe p≈ôi≈°el ze svƒõta jm√©nem Noxor, svƒõta, kter√Ω u≈æ neexistuje. V√≠m, ≈æe je posledn√≠. V√≠m, ≈æe p≈ôe≈æiv≈°√≠ se rozutekli, ale on, Nox, si mƒõ nƒõjak na≈°el. Hled√° domov, bezpeƒç√≠, l√°sku a p≈ô√°telstv√≠. A taky v√≠m, ≈æe m√° p≈ô√≠≈°ern√Ω hlad.
                Bez v√°h√°n√≠ ho vezmu do n√°ruƒçe. Je lehk√Ω jako p√≠rko, ale c√≠t√≠m z nƒõj obrovskou s√≠lu a smutek. Otev≈ôu dve≈ôe a vstoup√≠me do m√©ho bytu. Od t√© chv√≠le se st√°v√°me neoddƒõlitelnou dvojkou. Nox u≈æ nemus√≠ mluvit slovy. Staƒç√≠ mi pohled do jeho hlubok√Ωch oƒç√≠, nebo letm√Ω dotyk, a v≈ædycky v√≠m, co mi chce ≈ô√≠ct. A j√° v√≠m, ≈æe na≈°e dobrodru≈æstv√≠ teprve zaƒç√≠naj√≠.
            </p>
        </div>

        <div id="startScreen" class="space-y-4">
            <p class="text-gray-700 text-base leading-relaxed text-left">
                P≈ô√≠bƒõh Noxe zaƒç√≠n√°! P≈ôiprav se na dobrodru≈æstv√≠ se sv√Ωm vlastn√≠m stvo≈ôen√≠m jm√©nem Nox.
            </p>
            <button id="startGameButton" class="mt-6 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                Zaƒç√≠t hr√°t s Noxem!
            </button>
            <button id="showStoryButton" class="mt-6 bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                P≈ô√≠bƒõh
            </button>
        </div>

        <div id="gameStats" class="hidden space-y-4 flex flex-row items-start justify-center gap-8">
            <div class="flex-shrink-0 mt-6">
                <img src="005._nox.png" alt="Nox" class="w-48 h-auto rounded-3xl shadow-2xl border-4 border-indigo-600" />
            </div>

            <div class="flex-1 max-w-xl space-y-4">
                <h2 id="petNameDisplay" class="text-3xl font-bold text-indigo-700" aria-live="polite">Nox</h2>
                <div id="noxStatus" class="mt-2 text-red-500 font-bold hidden" role="status" aria-live="polite"></div>
                
                <div class="grid grid-cols-2 gap-4 mt-4">
                    <div class="flex items-center justify-between bg-gray-100 p-3 rounded-xl shadow-sm">
                        <span class="text-lg font-medium text-gray-700">Jm√©no:</span>
                        <span id="petName" class="text-xl font-bold text-gray-700">Nox</span>
                    </div>

                    <div class="flex items-center justify-between bg-gray-100 p-3 rounded-xl shadow-sm">
                        <span class="text-lg font-medium text-gray-700">Mƒõna:</span>
                        <span id="currencyDisplay" class="text-xl font-bold text-gray-700">100 Kredit≈Ø</span>
                    </div>

                    <div class="flex items-center justify-between bg-gray-100 p-3 rounded-xl shadow-sm">
                        <span class="text-lg font-medium text-gray-700">V√°ha:</span>
                        <span id="weightStat" class="text-xl font-bold text-gray-700">5 kg</span>
                    </div>
                    
                    <div class="flex items-center justify-between bg-gray-100 p-3 rounded-xl shadow-sm">
                        <span class="text-lg font-medium text-gray-700">Hlad:</span>
                        <span id="hungerStat" class="text-xl font-bold text-red-500">100%</span>
                    </div>
                    
                    <div class="flex items-center justify-between bg-gray-100 p-3 rounded-xl shadow-sm">
                        <span class="text-lg font-medium text-gray-700">Energie:</span>
                        <span id="energyStat" class="text-xl font-bold text-green-500">100%</span>
                    </div>
                    
                    <div class="flex items-center justify-between bg-gray-100 p-3 rounded-xl shadow-sm">
                        <span class="text-lg font-medium text-gray-700">Hygiena:</span>
                        <span id="hygieneStat" class="text-xl font-bold text-blue-500">100%</span>
                    </div>
                    
                    <div class="flex items-center justify-between bg-gray-100 p-3 rounded-xl shadow-sm">
                        <span class="text-lg font-medium text-gray-700">Z√°bava:</span>
                        <span id="funStat" class="text-xl font-bold text-yellow-500">100%</span>
                    </div>
                    
                    <div class="flex items-center justify-between bg-gray-100 p-3 rounded-xl shadow-sm">
                        <span class="text-lg font-medium text-gray-700">Spokojenost:</span>
                        <span id="satisfactionStat" class="text-xl font-bold text-purple-500">100%</span>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mt-6">
                    <button id="feedButton" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Nakrmit
                    </button>
                    <button id="batheButton" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Vykoupat
                    </button>
                    <button id="sleepButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Sp√°t
                    </button>
                    <button id="playButton" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Hr√°t si
                    </button>
                    <button id="talkButton" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Promluvit si
                    </button>
                    <button id="shopButton" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Obchod
                    </button>
                    <button id="firstAidKitButton" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        L√©k√°rniƒçka
                    </button>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mt-6">
                    <button id="jobManagementButton" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Spr√°va zamƒõstn√°n√≠
                    </button>
                    <button id="jobButton" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Zamƒõstn√°n√≠
                    </button>
                </div>

                <div class="grid grid-cols-2 gap-4 mt-6">
                    <button id="saveGameButton" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Exportovat do JSON
                    </button>
                    <button id="loadGameButton" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Nahr√°t ze souboru
                    </button>
                </div>
            </div>
        </div>

        <div id="foodMenu" class="hidden mt-6 p-4 bg-gray-50 rounded-xl shadow-inner space-y-3">
            <h3 id="foodMenuTitle" class="text-xl font-semibold text-gray-800 mb-3" tabindex="-1">Vyber j√≠dlo:</h3>
            <div id="foodOptions" class="grid grid-cols-2 gap-3">
                </div>
            <button id="closeFoodMenuButton" class="mt-4 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-xl shadow-md transition duration-300 ease-in-out">
                Zpƒõt
            </button>
        </div>

        <div id="playMenu" class="hidden mt-6 p-4 bg-gray-50 rounded-xl shadow-inner space-y-3">
            <h3 id="playMenuTitle" class="text-xl font-semibold text-gray-800 mb-3" tabindex="-1">Vyber si, co budete dƒõlat:</h3>
            <div id="playOptions" class="grid grid-cols-2 gap-3">
                </div>
            <button id="closePlayMenuButton" class="mt-4 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-xl shadow-md transition duration-300 ease-in-out">
                Zpƒõt
            </button>
        </div>
        
        <div id="shopMenu" class="hidden mt-6 p-4 bg-gray-50 rounded-xl shadow-inner space-y-3">
            <h3 id="shopMenuTitle" class="text-xl font-semibold text-gray-800 mb-3" tabindex="-1">V√≠tej v obchodƒõ, p√°n√≠ƒçku!</h3>
            <p class="text-lg text-gray-700">Tvoje Kredity: <span id="shopCurrencyDisplay" class="font-bold">0</span></p>
            <div id="shopItems" class="grid grid-cols-2 gap-3">
                </div>
            <button id="closeShopMenuButton" class="mt-4 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-xl shadow-md transition duration-300 ease-in-out">
                Zpƒõt
            </button>
        </div>
        
        <div id="firstAidKitMenu" class="hidden mt-6 p-4 bg-gray-50 rounded-xl shadow-inner space-y-3">
            <h3 id="firstAidKitMenuTitle" class="text-xl font-semibold text-gray-800 mb-3" tabindex="-1">Tvoje l√©k√°rniƒçka</h3>
            <div id="firstAidKitItems" class="grid grid-cols-2 gap-3">
                </div>
            <button id="closeFirstAidKitButton" class="mt-4 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-xl shadow-md transition duration-300 ease-in-out">
                Zpƒõt
            </button>
        </div>
        
        <div id="tasksMenu" class="hidden mt-6 p-4 bg-gray-50 rounded-xl shadow-inner space-y-3">
            <h3 id="tasksMenuTitle" class="text-xl font-semibold text-gray-800 mb-3" tabindex="-1">√ökoly</h3>
            <div id="tasksMenuContent" class="text-gray-600">
                </div>
            <div id="taskButtonsContainer" class="flex justify-center space-x-4 mt-4 hidden">
                <button id="acceptTaskButton" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-xl">P≈ôijmout</button>
                <button id="declineTaskButton" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-xl">Odm√≠tnout</button>
            </div>
            <button id="closeTasksMenuButton" class="mt-4 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-xl shadow-md transition duration-300 ease-in-out">
                Zpƒõt
            </button>
        </div>
        
        <div id="jobManagementMenu" class="hidden mt-6 p-4 bg-gray-50 rounded-xl shadow-inner space-y-3">
            <h3 id="jobManagementTitle" class="text-xl font-semibold text-gray-800 mb-3" tabindex="-1">Spr√°va zamƒõstn√°n√≠</h3>
            <div id="jobManagementContent" class="text-gray-600">
                <p class="mb-2">Zde m≈Ø≈æe≈° spravovat Noxovo zamƒõstn√°n√≠. Vyber pr√°ci, kterou bude Nox vykon√°vat.</p>
                <div id="currentJobDisplay" class="bg-gray-200 p-3 rounded-lg text-black mb-4">
                    <p id="currentJobText"></p>
                </div>
                <div id="jobList" class="space-y-2">
                    </div>
            </div>
            <button id="closeJobManagementMenuButton" class="mt-4 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-xl shadow-md transition duration-300 ease-in-out">
                Zpƒõt
            </button>
        </div>
        
        <div id="jobMenu" class="hidden mt-6 p-4 bg-gray-50 rounded-xl shadow-inner space-y-3">
            <h3 id="jobMenuTitle" class="text-xl font-semibold text-gray-800 mb-3" tabindex="-1">Zamƒõstn√°n√≠</h3>
            <div id="jobContent" class="text-gray-600">
                <p id="jobDescriptionText" class="mb-4">Nox je moment√°lnƒõ nezamƒõstnan√Ω. Vyber mu pr√°ci ve Spr√°vƒõ zamƒõstn√°n√≠.</p>
                <button id="startJobButton" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-xl shadow-md transition duration-300 ease-in-out hidden">
                    J√≠t do pr√°ce
                </button>
            </div>
            <button id="closeJobMenuButton" class="mt-4 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-xl shadow-md transition duration-300 ease-in-out">
                Zpƒõt
            </button>
        </div>

    </div>

    <div id="customMessageModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalMessageTitle" tabindex="-1" aria-live="assertive">
        <div class="modal-content" role="alert">
            <h3 id="modalMessageTitle" class="text-xl font-bold text-yellow-300 mb-4">Zpr√°va</h3>
            <p id="modalMessage" class="text-gray-300 mb-4"></p>
            <div class="modal-buttons text-right">
                <button id="modalCancelButton" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md ml-2 hidden">Zru≈°it</button>
                <button id="modalOkButton" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md">OK</button>
            </div>
        </div>
    </div>

    <script>
        // === V√ùCHOZ√ç KONFIGURACE A STAV HRY ===
        
        // Konstanta pro automatick√© ukl√°d√°n√≠ (v sekund√°ch)
        const AUTOSAVE_INTERVAL = 60; // ka≈æd√Ωch 60 sekund

        // Naƒçten√≠ Tone.js syntez√°tor≈Ø pro zvuky
        const simpleSynth = new Tone.Synth().toDestination();
        const polySynth = new Tone.PolySynth(Tone.Synth).toDestination();

        // Konfigurace j√≠dla
        const foodItems = [
            {
                name: "Granule",
                effects: {
                    hunger: 25, energy: -2, hygiene: 0, fun: -5, satisfaction: -5, weight: 0.1
                },
                taskReward: 5,
                messages: {
                    low: ["Hlad je nejlep≈°√≠ kucha≈ô. Nox sice granule v l√°sce nem√°, ale pro pln√© b≈ô√≠≈°ko udƒõl√° v≈°echno.", "Granule? No tak jo. Nox m√° velk√Ω hlad, a i obyƒçejn√© granule mu p≈ôijdou k chuti.", "Hele, p√°n√≠ƒçku, nebylo by nƒõco jin√©ho? Ne? Tak ne. Nox se pustil do j√≠dla. Ne proto≈æe by mu to chutnalo, ale proto, ≈æe je hladov√Ω."],
                    mid: ["Granule, no tak jo. Kdy≈æ jinak ned√°≈°. Nox se s p≈ôem√°h√°n√≠m pustil do j√≠dla, ale nad≈°en√Ω z toho nen√≠.", "Ach jo, v√°≈ænƒõ, granule? No tak jo. Nox se s nechut√≠ pustil do j√≠dla. Spo≈ô√°dal je jen proto, ≈æe je hladov√Ω.", "J√° tak nesn√°≈°√≠m granule. V≈ædycky po nich p≈°ouk√°m. Nox se s p≈ôem√°h√°n√≠m pou≈°t√≠ do j√≠dla."],
                    high: ["Tak tohle teda ne! Tohle j√≠st nebudu. Nox se znechucenƒõ odvr√°til od nev√°bn√Ωch granul√≠, a ode≈°el.", "N√©! Co ≈æe? Tohle fakt, ale fakt j√≠st nebudu. Nox se odvr√°til a odch√°z√≠ od j√≠dla.", "Ale fuj, to si jez s√°m. Nox p≈ôi≈°el k misce, a v≈°√≠ silou j√≠ packou poslal pryƒç. Miska narazila do zdi, a granule se vysypali."]
                }
            },
            {
                name: "Tƒõstoviny se s√Ωrem a ku≈ôec√≠m",
                effects: {
                    hunger: 40, energy: 5, hygiene: -5, fun: 15, satisfaction: 20, weight: 0.3
                },
                taskReward: 25,
                messages: {
                    low: ["M≈à√°m! Tohle je fakt lah≈Ødka. Nox se pou≈°t√≠ do j√≠dla s takovou chut√≠, ≈æe ho m√°lem spo≈ô√°dal i s miskou.", "Tƒõstovinky! To je pecka! Nox bƒõ≈æ√≠ k misce s obrovsk√Ωm nad≈°en√≠m. Je≈°tƒõ ne≈æ p≈ôed myskou zabrzdil, tak do n√≠ vrazil ƒçum√°k, a zaƒçal hltat.", "To je dobrota. To je takov√° dobrota. Tohle chci ƒçastƒõji. Nox bƒõhem mrknut√≠ oka j√≠dlo spo≈ô√°dal, a pak zaƒçal m√°lem j√≠st i misku."],
                    mid: ["Dneska m√° nƒõkdo narozeniny? Nox se s l√°skou pustil do j√≠dla, a vychutn√°v√° ka≈æd√© sousto.", "J√≥! Tohle je m≈àamka. Nox se s chut√≠ pou≈°t√≠ do j√≠dla, a bƒõhem chvilky ho m√° v sobƒõ. Pak si od≈ô√≠hne, zavrt√≠ se, a koukne na tebe."],
                    high: ["Tohle miluju! Nox si j√≠dlo tak vychutn√°v√°, ≈æe blahem vrn√≠.", "Ty jo, tƒõstoviny. To je lahoda. Je vidƒõt, jak se nox s j√≠dlem vyslovenƒõ mazl√≠. ƒåum√°k m√° cel√Ω od om√°ƒçky, a nƒõco se mu dostalo i do srsti. Bude≈° ho muset vykoupat.", "Kdy≈æ d√°v√°≈° Noxovy j√≠dlo, tak ti nejprve skoƒç√≠ do n√°ruƒçe. Jeho vdƒõƒçnost je v√≠c ne≈° z≈ôejm√°. Nox v m≈æiku j√≠dlo spo≈ô√°d√°. Ten jeho pohled je k nezaplacen√≠."]
                }
            },
            {
                name: "Vep≈ôov√° kotleta",
                effects: {
                    hunger: 50, energy: 10, hygiene: -10, fun: 20, satisfaction: 25, weight: 0.4
                },
                taskReward: 25,
                messages: {
                    low: ["Kotletko moje milovan√°. Tolik se na tebe tƒõ≈°√≠m. Nox j√≠ nejprve opatrnƒõ ol√≠zl, ale pak j√≠ rychle spo≈ô√°dal.", "Kotleta? No teda p√°n√≠ƒçku. Ty jsi √∫≈æasnej. Nox se s chut√≠ pou≈°t√≠ do hlt√°n√≠ kotlety.", "Kotleta kotletka, se≈æeru j√≠ hnedka. Nox se s obrovskou chut√≠ pou≈°t√≠ do j√≠dla. M√° takov√Ω hlad, ≈æe mu hed d√°v√°≈° druhou."],
                    mid: ["No, tak tohle jsme na Noxoru nemƒõli. Kotletu prostƒõ miluji. Ani nemrkne≈°, a nox m√° kotletu v sobƒõ.", "Takov√° lah≈Ødka. Nechtƒõl sis j√≠ d√°t ty s√°m p√°n√≠ƒçku? Ne? Ty jsi ale √∫≈æasnej. Nox se s chut√≠ pou≈°t√≠ do j√≠dla.", "Jestli se p√°n√≠ƒçku nepletu, tak c√≠t√≠m lahodnou vep≈ôovou kotletu. Nox j√≠ zhltne bƒõhem vte≈ôiny."],
                    high: ["Nox ≈°≈•astnƒõ zavrn√≠, b≈ô√≠≈°ko si kotletou napln√≠. Nox m√° kotletu moc r√°d.", "Ty jo, to byl ale luxus. Nem√°≈° tam je≈°tƒõ jednu? Pozor! Dal≈°√≠ u≈æ mu ned√°vej, jinak se ti tu pozvrac√≠.", "Tak, Nox√≠ku. Dnes si d√°me oba to sam√©. Nox oƒçich√° tv≈Øj tal√≠≈ô. Potom zjist√≠, ≈æe m√° to sam√© v misce, a s chut√≠ se pou≈°t√≠ do j√≠dla."]
                }
            },
            {
                name: "Syrov√© maso",
                effects: {
                    hunger: 35, energy: 15, hygiene: -5, fun: -10, satisfaction: -5, weight: 0.2
                },
                taskReward: 25,
                messages: {
                    low: ["Syrov√© mas√≠ƒçko, pak zes√≠l√≠m maliƒçko. Nox sice syrov√© maso moc nemus√≠, ale m√° po nƒõm kr√°snou srst, a vƒõt≈°√≠ s√≠lu.", "Syrov√© maso? No ale m≈àam, ty kr√°so. Nox se hltavƒõ pou≈°t√≠ do j√≠dla. Dej pozor Noxi, abys tam nena≈°el p≈ôehl√©dnutou kost.", "Nox m√° takov√Ω hlad, ≈æe spo≈ô√°d√° j√≠dlo bƒõhem sekundy. Pozor! Syrov√© maso je dobr√© na s√≠lu a srst, ale v nadmƒõrn√©m mno≈æstv√≠ m≈Ø≈æe doj√≠t u noxe k otravƒõ."],
                    mid: ["Nox se tƒõ≈°√≠ na nƒõco dobr√©ho. Kdy≈æ p≈ôijde k misce, tak zjist√≠, ≈æe tam m√° jen syrov√© maso. Nen√≠ moc nad≈°en√Ω, ale sn√≠ ho.", "Nox m√° takov√Ω hlad, ≈æe mu syrov√© maso chutn√°. Jak se ≈ô√≠k√°, hlad je nejlep≈°√≠ kucha≈ô.", "A co ty p√°n√≠ƒçku? Ty by sis nedal syrov√© maso? Ne? No vid√≠≈°, a j√° ho m√°m j√≠st? Nox se bez nad≈°en√≠ pou≈°t√≠ do j√≠dla."],
                    high: ["P√°n√≠ƒçku to si dƒõl√°≈° srandu? Promi≈à, ale tohle j√≠st nebudu. Jo, kdy≈æ m√° nox fakt hlad, tak i syrov√© maso poz≈ôe. Jen≈æe teƒè m√° jen mal√Ω hlad, a tak si vyb√≠r√°.", "Ech, syrov√© maso? Nechce≈° ho hodit na p√°nev, a nƒõco z nƒõho uklohnit? Takhle to j√≠st nebudu.", "P√°n√≠ƒçku promi≈à, ale tohle si jez s√°m. J√° na to nem√°m ≈æaludek."]
                }
            },
            {
                name: "Va≈ôen√° zelenina",
                effects: {
                    hunger: 10, energy: 0, hygiene: 0, fun: -20, satisfaction: -30, weight: -0.5
                },
                taskReward: 5,
                messages: {
                    low: ["Va≈ôen√° zelenina je hnus p√°n√≠ƒçku. V√≠≈° to? Nakonec j√≠ nox sn√≠, proto≈æe um√≠r√° hlady.", "Va≈ôen√° zelenina? To si snad dƒõl√°≈° srandu. J√° j√≠ sn√≠m, proto≈æe hlady ≈°ilh√°m. Nox zeleninu snƒõdl, ale n√°lada mu prudce poklesla.", "Ach ne! Udƒõlal jsem nƒõco ≈°patn√©ho? Nox fakt nesn√°≈°√≠ va≈ôenou zeleninu. Teƒè m√° ale brut√°ln√≠ hlad, a tak j√≠ sn√≠."],
                    mid: ["Ale fuj! Co to m√°m v misce? Vypad√° to, jako kdyby to p≈ôede mnou u≈æ nƒõkdo jedl. Nox j√≠dlo sn√≠, ale radost z toho nem√°.", "Ty tohle j√≠≈° p√°n√≠ƒçku? Jo? No tak to tƒõ lituji. Nox s odporem j√≠dlo spo≈ô√°d√°.", "J√° tak nesn√°≈°√≠m va≈ôenou zeleninu. U≈æ jsi nƒõkdy vidƒõl psa, jak j√≠ zeleninu? J√° sice pes nejsem, ale jsem mu dost podobn√Ω. Nox j√≠dlo sn√≠, ale fakt mu nechutn√°."],
                    high: ["Tak tohle j√≠st nebudu. Nox se na≈°tvanƒõ odvr√°t√≠, a jde do pel√≠≈°ku.", "Zelenina to je hnus, kdo j√≠ ≈æere, nem√° vkus! J√° vkus m√°m, a j√≠st to rozhodnƒõ nebudu.", "Nox se sna≈æil zdrhnout v okam≈æiku, kdy jsi mu do misky d√°val va≈ôenou zeleninu. Nakonec se p≈ôemohl a snƒõdl j√≠. P≈ôiprav se na Noxovo legend√°rn√≠, a rozhodnƒõ ne vo≈àav√©, p≈°ouk√°n√≠. To bude≈° koukat, jak Nox bude p≈°oukat."]
                }
            },
            {
                name: "Tatranka",
                effects: {
                    hunger: 15, energy: 5, hygiene: -3, fun: 10, satisfaction: 10, weight: 0.2
                },
                taskReward: 15,
                messages: {
                    low: ["Nox m√° stra≈°n√Ω hlad. Ne≈æ si uvƒõdomil co j√≠, tak j√≠ mƒõl v sobƒõ.", "Nox m√° takov√Ω hlad, ≈æe i tatranka mu p≈ôijde k duhu.", "Tatranka zmizela v Noxov√Ωch √∫trob√°ch tak rychle, ≈æe sis toho ani nev≈°iml."],
                    mid: ["Tatranku miluji. D√°m si j√≠ jen jednou, slibuji. Nox j√≠ sn√≠, ≈æe to ani nezaregistruje≈°.", "Tatranka! Tu m√°m stra≈°nƒõ r√°d. Nox j√≠ spolkl celou, ani nekousal.", "Nox p≈ôijde k misce, a kouk√°. Tatranka? To se asi p√°n√≠ƒçek musel spl√©st. Nox j√≠ snƒõdl okam≈æitƒõ."],
                    high: ["A, z√°kuseƒçek. To si d√°m l√≠bit.", "No tedy p√°n√≠ƒçku, ty mƒõ rozmazluje≈°. Ale d√≠ky.", "M≈àam, tatranka. To je dobr≈Øtka."]
                }
            },
            {
                name: "Kol√°ƒç",
                effects: {
                    hunger: 20, energy: 8, hygiene: -8, fun: 15, satisfaction: 20, weight: 0.3
                },
                taskReward: 15,
                messages: {
                    low: ["P√°n√≠ƒçku? Dnes m√° nƒõkdo narozeniny? Nox se vrh√° na kol√°ƒç, a≈æ mu drobky odletuj√≠ od zbƒõsile p≈ôe≈ævykuj√≠c√≠ch ƒçelist√≠.", "Nox tak moc hlt√°, a≈æ se z toho zad√Ωchal. Hlad je prostƒõ hlad.", "Nox trp√≠ hlady, a kol√°ƒç mu dod√° energiy. Moc by ho ale j√≠st nemƒõl."],
                    mid: ["Nox se pokus√≠ kol√°ƒç sn√≠st najednou, jen ≈æe mu to nejde. Nakonec se rozhodne, ≈æe ho sn√≠ norm√°lnƒõ. Koukejme jak mu chutn√°.", "Nox tak stra≈°nƒõ hlt√°, a≈æ se z toho zakuck√°, a mus√≠ na chvilku p≈ôestat. Jo chlapƒçe, tvarohov√Ω kol√°ƒç se mus√≠ j√≠st pomalu, aby ti nezaskoƒçil.", "No tedy p√°n√≠ƒçku. Kol√°ƒç? Tak to je lahoda. Nox se s velkou chut√≠ pou≈°t√≠ do j√≠dla."],
                    high: ["Kol√°ƒçek si s chut√≠ d√°m, r√°no pƒõkn√© bobky m√°m. Nox si vychutn√°v√° ka≈æd√© sousto.", "To bych byl ale hlup√°ƒçek, abych si nedal kol√°ƒçek. Nox se s n√≠m nejprve lask√°, ale pak ho zhltne. Pozor! NOx m√° drobky i na srsti. Bude≈° ho muset vykoupat.", "No p√°ni. To jsem musel b√Ωt obzvl√°≈°≈• hodn√Ω, ≈æe my p√°n√≠ƒçek dal kol√°ƒç."]
                }
            },
            {
                name: "Kobliha",
                effects: {
                    hunger: 10, energy: 3, hygiene: -15, fun: 5, satisfaction: 5, weight: 0.2
                },
                taskReward: 15,
                messages: {
                    low: ["V√°≈ænƒõ? Nox ti tu um√≠r√° hlady, a ty mu d√°≈° koblihu. No u≈æ je pozdƒõ. Nox j√≠ celou zhltl, ale marmel√°du m√° a≈æ na hlavƒõ.", "Kobliha v√°≈ænƒõ nen√≠ dobr√° pro noxe. V√°≈ænƒõ mu j√≠ chce≈° d√°t? A, u≈æ je pozdƒõ. No pod√≠vej se na toho ƒçun√≠ka. Marmel√°du m√° a≈æ za u≈°ima.", "Noxi ty jsi ale ƒçunƒõ! Pod√≠vej se, jak vypad√°≈°. Proboha kam a≈æ se ti ta marmel√°da dostala?"],
                    mid: ["Tohle nen√≠ dobr√Ω n√°pad. Tohle fakt nen√≠ dobr√Ω n√°pad. Nox zhltl koblihu, ale je cel√Ω ≈°pinav√Ω.", "Ty jsi se musel asi zbl√°znit. Pod√≠vej na Noxe, jak je cel√Ω od marmel√°dy. M≈Ø≈æe si ≈ô√≠kat marmel√°dov√Ω Joe. ≈†mahem ho bƒõ≈æ vykoupat!", "Tak tohle je ne≈°≈•astn√©. Nox koblihu zhltl, ale n√°pl≈à se mu dostala na packy. Teƒè tu chod√≠, a packama rozmaz√°v√° n√°pl≈à po zemi. Mazej ho vykoupat, a rychle!"],
                    high: ["To jako v√°≈ænƒõ? No, u≈æ je pozdƒõ. Nox skousnul koblihu, ale v≈°echno mu vyteklo na packy. Vykoupej ho, a≈• nem√°≈° marmel√°du v≈°ude.", "Nox prostƒõ neum√≠ j√≠st koblihy. U≈æ mu je pros√≠m ned√°vej. Je cel√Ω umazan√Ω. Je ale vidƒõt, ≈æe je spokojen√Ω."]
                }
            },
            {
                name: "Hovƒõz√≠ v√Ωvar",
                effects: {
                    hunger: 30, energy: 10, hygiene: -5, fun: 10, satisfaction: 15, weight: -0.1
                },
                taskReward: 35,
                messages: {
                    low: ["J√≥, tak tohle je lah≈Ødka. Nox m√° v√Ωvar hroznƒõ r√°d. Zvl√°≈°≈•, kdy≈æ je v nƒõm hodnƒõ masa.", "V√Ωvar pro noxe, je jako kavi√°r pro ƒçlovƒõka. Nox ho zbo≈æ≈àuje.", "Nox m√° tak stra≈°n√Ω hlad, ≈æe zaƒçne v√Ωvar hltat. Jen≈æe cint√° v≈°ude kolem, a dokonce i na sebe."],
                    mid: ["Nox miluje v√Ωvar. Miluje ho tak moc, ≈æe je to a≈æ legraƒçn√≠.", "Nox zabo≈ôil ƒçum√°k do v√Ωvaru, a≈æ se kolem rozst≈ô√≠kl.", "Jo, v√Ωvar je fakt dobrota. Nox si ho u≈æ√≠v√°. Ach jo, pr√°vƒõ do nƒõj omylem vrazil packou, a≈æ se trocha rozst≈ô√≠kla."],
                    high: ["No p√°ni? Kouk√°m p√°n√≠ƒçku, ≈æe ses kv≈Øli me, patlal s v√Ωvarem. Dƒõkuji moc.", "V√Ωvar? To je blaho. B≈ôicho m√°m je≈°tƒõ tro≈°ku pln√©, ale v√Ωvarem nikdy nepohrdnu.", "M≈àam, to je lah≈Øƒçka."]
                }
            },
            {
                name: "Pivo",
                effects: {
                    hunger: 5, energy: -15, hygiene: -5, fun: 20, satisfaction: -20, weight: 0
                },
                taskReward: 5,
                messages: {
                    low: ["Ty si se musel asi zbl√°znit. Prost≈ôed√≠ z jin√©ho svƒõta, a ty mu d√°v√°≈° pivo? Nox hlady ≈°ilh√° a jedin√© co dostane, je pivo. Tlesk√°m, fakt super!", "Tak tos p≈ôehnal! Noxovi pivo zachutnalo, ale je mu po nƒõm dost zle.", "Nox p≈ôi≈°el k misce a kouk√° se, co to v n√≠ m√°. Ochutn√°, ≈ô√≠hne si, ale pak to v≈°echno vypije. Odnes ho pros√≠m do pelechu, proto≈æe on to s√°m nedok√°≈æe."],
                    mid: ["Promi≈à, j√° to asi nech√°pu. Tato hra je o tom, ≈æe se star√°≈° o mazl√≠ƒçka z jin√©ho svƒõta. A ty mu d√°v√°≈° pivo? No, tak teƒè m√°≈° probl√©m. Noxovi je po nƒõm ≈°patnƒõ.", "J√° fakt nev√≠m, co t√≠m sleduje≈°. Ty uƒç√≠≈° noxe kalit, aby ti dƒõlal v baru spoleƒçn√≠ka?", "A koukejme, co to m√° Nox v misce. Pivo? No, pak po nƒõm bude≈° muset vyt√≠rat podlahu, proto≈æe on ho za chviliƒçku vyzvrac√≠."],
                    high: ["P√°n√≠ƒçku, ale tohle nen√≠ pro mƒõ. J√° pivo nechci. Je my po nƒõm ≈°patnƒõ, a stra≈°nƒõ se mot√°m.", "No, tak tohle p√≠t nebudu. Vodu ano, ale tohle ne.", "P√°n√≠ƒçku, ale j√° chci vodu. J√° m√°m ≈æ√≠ze≈à, ale nechci se op√≠t."]
                }
            }
        ];
        
        const playItems = [
            { name: "Mazlit se", effects: { fun: 20, energy: -5, hunger: -2, satisfaction: 15, weight: -0.1 } },
            { name: "Aportovat", effects: { fun: 30, energy: -20, hunger: -10, satisfaction: 25, weight: -0.5 } },
            { name: "J√≠t na proch√°zku", effects: { fun: 25, energy: -15, hunger: -8, satisfaction: 20, weight: -0.25 } },
            { name: "J√≠t si hr√°t ven", effects: { fun: 40, energy: -30, hunger: -15, satisfaction: 30, weight: -0.5 } },
            { name: "Le≈æet a poslouchat audioknihu", effects: { fun: 10, energy: 5, hunger: -1, satisfaction: 10, weight: 0.25 } }
        ];

        const noxMessages = {
            bath: [
                "A pod√≠vejme, jak prokouknul. Jsem ƒçist√Ω a vo≈àav√Ω. Ten ≈°amp√≥n dƒõl√° divy!",
                "M√°m velkou radost, ≈æe jsi mƒõ vykoupal. Ne≈æ jsi mƒõ staƒçil ut≈ô√≠t, tak jsem se oklepal, a cel√©ho tƒõ poc√°kal.",
                "Je≈æi≈° to je kr√°sn√Ω pocit. Jsem zabalen√Ω v ruƒçn√≠ku, spokojenƒõ odfrk√°v√°m, a le≈æ√≠m ti v n√°ruƒç√≠."
            ],
            sleep: {
                low: ["Pod√≠vej, jak kr√°snƒõ sp√≠m, ten n√°≈° ≈°mudla.", "Sp√≠m tak n√°dhernƒõ. Nebudeme mƒõ ru≈°it, a≈• se nevzbud√≠m.", "Nejprve jsem spal v pel√≠≈°ku, ale pak jsem se p≈ôesunul k tobƒõ. Vzal jsi mƒõ do n√°ruƒçe, a tam jsem spokojenƒõ a tvrdƒõ usnul."],
                mid: ["Pod√≠vej se na mƒõ. Hoj√≠m si v pel√≠≈°ku, a spokojenƒõ odfukuji.", "Nechtƒõl jsem sp√°t v pel√≠≈°ku, ale u tebe v posteli. Le≈æ√≠m u tebe, a poslouch√°m tlukot tv√©ho srdce. Jsem ≈°≈•astn√Ω a spokojen√Ω.", "Schoulil jsem se do pel√≠≈°ku, a spokojenƒõ usnul. Ty jsi mƒõ je≈°tƒõ polaskal, a pak jsi ode≈°el."],
                high: ["M√°m nƒõjak√Ω ≈æiv√Ω sen. Hrabej packami, a nƒõco si v m√© ≈ôeƒçi mrml√°m.", "Kr√°tk√© zd≈ô√≠mnut√≠ je≈°tƒõ nikomu neu≈°kodilo. Nejsem moc unaven√Ω, ale r√°d odpoƒç√≠v√°m.", "Na hodinku jsem si schrupnul, ale u≈æ jsem zase ƒçil√Ω a hrav√Ω."]
            },
            talk: {
                howAreYou: {
                    low: ["J√° se m√°m moc zle, p√°n√≠ƒçku. M√°m hrozn√Ω hlad, jsem p≈ô√≠≈°ernƒõ ≈°pinav√Ω a hroznƒõ unaven√Ω. Nec√≠t√≠m se moc dob≈ôe.", "Jsem smutn√Ω. B≈ôicho m√°m pr√°zdn√©, ≈°p√≠nu m√°m a≈æ za u≈°ima, a spal bych, a≈æ bych breƒçel.", "Jsem na≈°tvan√Ω. M√°m hlad, jsem ≈°pinav√Ω a chci sp√°t, ale nem≈Ø≈æu. Vrrrr!"],
                    mid: ["Ani dob≈ôe, ani zle. M√°m dost hlad. Tak√© se my nel√≠b√≠, ≈æe jsem tak ≈°pinav√Ω. Chci sp√°t, ale ta neƒçistota my vad√≠.", "Jo p√°n√≠ƒçku, mohlo by b√Ωt l√©pe. Kdybys my dal naj√≠st, a vykoupal mƒõ. Pak bych byl spokojen√Ω.", "P√°n√≠ƒçku, nechce≈° my d√°t naj√≠st? Taky jsem ≈°pinav√Ω, a chci sp√°t."],
                    high: ["J√° se m√°m dob≈ôe. Co ty? Jsem spokojen√Ω a vesel√Ω. C√≠t√≠m se √∫≈æasnƒõ!", "Jsem ve skvƒõl√© n√°ladƒõ! D√≠ky tobƒõ m√°m v≈°echno, co pot≈ôebuji.", "M√°m se v√Ωbornƒõ, p√°n√≠ƒçku. ≈Ωivot je kr√°sn√Ω!"]
                }
            },
            lowStats: "M√°m mal√Ω hlad, jsem unaven√Ω a ≈°pinav√Ω. M√°m taky m√°lo energie, a u≈æ se moc neusm√≠v√°m. Udƒõlej se mnou nƒõco, pros√≠m. Pot≈ôebuji pomoct.",
            lowSatisfaction: "C√≠t√≠m se smutn√Ω. Chce≈° si se mnou promluvit?",
            overweight: "J√©je, p√°n√≠ƒçku, m√°m nadv√°hu. Mƒõl bych v√≠ce cviƒçit. M≈Ø≈æe≈° my s t√≠m pros√≠m pomoct?",
            underweight: "P√°n√≠ƒçku, jsem podvy≈æiven√Ω. Pot≈ôebuji v√≠ce j√≠dla, abych zes√≠lil, a mohl ti pomoct?"
        };

        const shopItems = [
            {
                name: "≈Ωv√Ωkac√≠ kost",
                price: 50,
                type: "toy",
                effects: {
                    fun: 25,
                    satisfaction: 15,
                    hygiene: -5
                },
                message: "Noxovi se v oƒç√≠ch rozz√°≈ôily jiskry. Hned se do kosti zakousnul a spokojenƒõ vrn√≠."
            },
            {
                name: "Luxusn√≠ pel√≠≈°ek",
                price: 200,
                type: "bed",
                effects: {
                    satisfaction: 50,
                    energy: 20,
                    hygiene: 10
                },
                message: "Nox si pel√≠≈°ek okam≈æitƒõ zamiloval. Schoulil se do nƒõj a usnul s bla≈æen√Ωm √∫smƒõvem na tv√°≈ôi."
            },
            {
                name: "Zlat√© kapsiƒçky",
                price: 75,
                type: "food",
                effects: {
                    hunger: 50,
                    satisfaction: 25,
                    hygiene: -5
                },
                message: "Nox si vychutn√°v√° ka≈æd√© sousto. To je pane dobrota!"
            },
            {
                name: "L√©ƒçiv√Ω lektvar",
                price: 300,
                type: "potion",
                effects: {
                    hunger: 10,
                    energy: 10,
                    hygiene: 10,
                    fun: 10,
                    satisfaction: 10
                },
                message: "Nox se napil lektvaru a v≈°echny jeho statistiky se stabilizovaly."
            },
            {
                name: "Noxolit",
                price: 50,
                type: "medicine",
                message: "Po l√©ku se c√≠t√≠m mnohem l√©pe. Teƒè jsem p≈ôipraven√Ω na jakoukoliv v√Ωzvu!"
            },
            {
                name: "Noxotronik",
                price: 50,
                type: "medicine",
                message: "Ulevilo se mi. Teƒè u≈æ mƒõ z b≈ô√≠≈°ka nic nebol√≠."
            },
            {
                name: "Nomax",
                price: 400,
                type: "potion",
                message: "Cel√Ω jsem se rozz√°≈ôil a z√°≈ô√≠ ≈°tƒõst√≠m. V≈°echny m√© pot≈ôeby jsou naplnƒõny!"
            },
            {
                name: "Noxofit",
                price: 450,
                type: "potion",
                message: "C√≠t√≠m se lehƒç√≠ a jsem pln√Ω energie. Znovu se dostal na svou ide√°ln√≠ v√°hu!"
            }
        ];
        
        const jobsConfig = {
            "Z√°chran√°≈ô": {
                name: "Z√°chran√°≈ô",
                duration: 5 * 60, // 5 minut
                reward: 100,
                description: "Nox bude pracovat v hor√°ch, kde bude hledat lavinou zavalen√© lidi.",
                messages: [
                    "Ty jo, to byla ale ≈°ichta. Dnes jsem zachr√°nil nƒõkolik lid√≠.",
                    "Dneska byla ale nuda. ≈Ω√°dn√° lavina, a tak jsme cel√Ω den jen odpoƒç√≠vali, a chlemtali ƒçaj.",
                    "Dneska jsem zachr√°nil jednoho turistu co lezl po hor√°ch, a p≈ôecenil svoje s√≠ly."
                ]
            },
            "Hl√≠daƒç": {
                name: "Hl√≠daƒç",
                duration: 8 * 60, // 8 minut
                reward: 80,
                description: "Nox hl√≠d√° pozemek, aby se tam nikdo nevloupal.",
                messages: [
                    "T√©da, dneska byla √°le n≈Ød√°. Nic se nedƒõlo.",
                    "J√° jsem tak unaven√Ω. Odchytil jsem t√Ωpka co se chtƒõl vloupat na pozemek, a tak jsem ho pƒõknƒõ prohnal.",
                    "Nev√≠≈° co se to dneska s lidmi dƒõje? Ka≈æd√Ω se nutnƒõ chtƒõl dostat na soukrom√Ω pozemek."
                ]
            },
            "Ochr√°nce": {
                name: "Ochr√°nce",
                duration: 7 * 60, // 7 minut
                reward: 60,
                description: "Nox pom√°h√° ve mƒõstƒõ, kde bude pom√°hat dƒõtem a star√Ωm lidem s p≈ôech√°zen√≠m p≈ôes ru≈°nou silnici.",
                messages: [
                    "Dneska byla legrace. P≈ôev√°dƒõl jsem dƒõti ze ≈°kolky. Jejich uƒçitelka my podƒõkovala za to, jak pƒõknƒõ pom√°h√°m.",
                    "Dneska jsem pom√°hal jedn√© star√© d√°mƒõ. Kdy≈æ jsem j√≠ p≈ôevedl, tak mƒõ pohladila, a dala my kol√°ƒçek.",
                    "Dneska jsem pom√°hal jednomu nevidom√©mu, a byla s n√≠m sranda. Kdy≈æ jsem ho p≈ôevedl, tak se se mnou pƒõknƒõ pomazlil, a celou dobu se sm√°l."
                ]
            },
            "Filmov√° bran≈æe": {
                name: "Filmov√° bran≈æe",
                duration: 12 * 60, // 12 minut
                reward: 125,
                description: "Nox pracuje u filmu, kde obƒças dostane roli.",
                messages: [
                    "P√°n√≠ƒçku, dostal jsem roli! Budu hr√°t ve filmu!",
                    "Dnes jsem dƒõlal kaskad√©ra pro jeden film, ve kter√©m hraj√≠ jen zv√≠≈ôata. Sezn√°mil jsem se z jednou pƒõknou mickou.",
                    "Dnes jsem mƒõl na m√°le, p√°n√≠ƒçku. Dƒõlal jsem kaskad√©ra, a musel skoƒçit z jednoho jedouc√≠ho auta do druh√©ho. Bylo to o fous. Na ≈°tƒõst√≠ se z√°bƒõr povedl. Re≈æiz√©r mƒõ pochv√°lil."
                ]
            },
            "Terapeut": {
                name: "Terapeut",
                duration: 15 * 60, // 15 minut
                reward: 150,
                description: "Nox pom√°h√° dƒõtem a lidem s posti≈æen√≠m, nebo nƒõjak√Ωm traumatem.",
                messages: [
                    "P√°n√≠ƒçku, üò¢ j√° jsem tak smutn√Ω. Dneska jsem byl u jedn√© mal√© holƒçiƒçky. Pak jsem zjistil, ≈æe m√° rakovinu, a dlouho u≈æ tu nebude. Od n√≠ jsem odch√°zel stra≈°nƒõ smutn√Ω.",
                    "Dneska jsem byl u jednoho klouƒçka, kter√Ω se b√°l ps≈Ø. Le≈æel jsem u nƒõj, a v tom se to stalo. Zaƒçal mƒõ hladit, a zaƒçalo se mu to l√≠bit. D√≠ky mƒõ u≈æ nem√° strach. Kdy≈æ jsem odch√°zel, tak sly≈°√≠m. Mami, nepo≈ô√≠d√≠me si pejska? To bylo tak kr√°sn√©.",
                    "Dnes jsem pom√°hal v domovƒõ d√∫chodc≈Ø. Mƒõlo to √∫spƒõch, a z√≠tra m√°m p≈ôij√≠t zase. Jsou tam hroznƒõ hodn√© babiƒçky."
                ]
            }
        };

        // Objekt s aktu√°ln√≠m stavem hry
        let nox = {
            hunger: 100,
            energy: 100,
            hygiene: 100,
            fun: 100,
            satisfaction: 100,
            weight: 5,
            currency: 100,
            isSick: false,
            isPoisoned: false,
            playCount: 0,
            bathCount: 0,
            lastFood: null,
            sameFoodCount: 0,
            inventory: [],
            currentJob: null,
            isWorking: false,
            workTimer: null,
            workRemaining: 0,
            lastWarning: null
        };

        let gameInterval;
        let autoSaveInterval;

        // === REFERENCE NA HTML PRVKY ===
        const elements = {
            startScreen: document.getElementById('startScreen'),
            showStoryButton: document.getElementById('showStoryButton'),
            startGameButton: document.getElementById('startGameButton'),
            gameStats: document.getElementById('gameStats'),
            petNameDisplay: document.getElementById('petNameDisplay'),
            foodMenu: document.getElementById('foodMenu'),
            foodOptionsContainer: document.getElementById('foodOptions'),
            closeFoodMenuButton: document.getElementById('closeFoodMenuButton'),
            playMenu: document.getElementById('playMenu'),
            playOptionsContainer: document.getElementById('playOptions'),
            closePlayMenuButton: document.getElementById('closePlayMenuButton'),
            shopMenu: document.getElementById('shopMenu'),
            shopItemsContainer: document.getElementById('shopItems'),
            closeShopMenuButton: document.getElementById('closeShopMenuButton'),
            noxStatusElem: document.getElementById('noxStatus'),
            firstAidKitButton: document.getElementById('firstAidKitButton'),
            firstAidKitMenu: document.getElementById('firstAidKitMenu'),
            firstAidKitItemsContainer: document.getElementById('firstAidKitItems'),
            closeFirstAidKitButton: document.getElementById('closeFirstAidKitButton'),
            tasksButton: document.getElementById('tasksButton'),
            tasksMenu: document.getElementById('tasksMenu'),
            tasksMenuContent: document.getElementById('tasksMenuContent'),
            taskButtonsContainer: document.getElementById('taskButtonsContainer'),
            acceptTaskButton: document.getElementById('acceptTaskButton'),
            declineTaskButton: document.getElementById('declineTaskButton'),
            closeTasksMenuButton: document.getElementById('closeTasksMenuButton'),
            jobManagementButton: document.getElementById('jobManagementButton'),
            jobButton: document.getElementById('jobButton'),
            jobManagementMenu: document.getElementById('jobManagementMenu'),
            closeJobManagementMenuButton: document.getElementById('closeJobManagementMenuButton'),
            jobMenu: document.getElementById('jobMenu'),
            closeJobMenuButton: document.getElementById('closeJobMenuButton'),
            jobListContainer: document.getElementById('jobList'),
            currentJobText: document.getElementById('currentJobText'),
            jobDescriptionText: document.getElementById('jobDescriptionText'),
            startJobButton: document.getElementById('startJobButton'),
            hungerStatElem: document.getElementById('hungerStat'),
            energyStatElem: document.getElementById('energyStat'),
            hygieneStatElem: document.getElementById('hygieneStat'),
            funStatElem: document.getElementById('funStat'),
            satisfactionStatElem: document.getElementById('satisfactionStat'),
            weightStatElem: document.getElementById('weightStat'),
            currencyDisplay: document.getElementById('currencyDisplay'),
            shopCurrencyDisplay: document.getElementById('shopCurrencyDisplay'),
            feedButton: document.getElementById('feedButton'),
            batheButton: document.getElementById('batheButton'),
            sleepButton: document.getElementById('sleepButton'),
            playButton: document.getElementById('playButton'),
            talkButton: document.getElementById('talkButton'),
            shopButton: document.getElementById('shopButton'),
            saveGameButton: document.getElementById('saveGameButton'),
            loadGameButton: document.getElementById('loadGameButton'),
            customMessageModal: document.getElementById('customMessageModal'),
            modalMessageTitle: document.getElementById('modalMessageTitle'),
            modalMessage: document.getElementById('modalMessage'),
            modalCancelButton: document.getElementById('modalCancelButton'),
            modalOkButton: document.getElementById('modalOkButton')
        };
        
        // Ukl√°d√°me si, kter√Ω prvek byl naposledy zaost≈ôen√Ω, abychom se k nƒõmu mohli vr√°tit
        let lastFocusedElement = null;

        // === ZVUKOV√â FUNKCE ===
        function playSound(type) {
            if (Tone.context.state !== 'running') {
                Tone.start();
            }

            switch (type) {
                case 'action': simpleSynth.triggerAttackRelease("C5", "8n"); break;
                case 'warning':
                    simpleSynth.triggerAttackRelease("C3", "16n", Tone.now());
                    simpleSynth.triggerAttackRelease("C2", "16n", Tone.now() + 0.1);
                    break;
                case 'gameOver': polySynth.triggerAttackRelease(["C3", "G2", "Eb2"], "2n"); break;
                case 'happy': simpleSynth.triggerAttackRelease("E5", "8n"); break;
                case 'grumpy': simpleSynth.triggerAttackRelease("C4", "8n"); break;
                case 'eating': simpleSynth.triggerAttackRelease("G4", "16n"); break;
                case 'badFood': simpleSynth.triggerAttackRelease("C3", "8n"); break;
                case 'sleeping': simpleSynth.triggerAttackRelease("A3", "4n"); break;
                case 'playful': simpleSynth.triggerAttackRelease("G5", "8n"); break;
                case 'activity': simpleSynth.triggerAttackRelease("D5", "8n"); break;
                case 'saveLoad': simpleSynth.triggerAttackRelease("C6", "16n"); break;
                case 'jobDone':
                    simpleSynth.triggerAttackRelease("E4", "8n");
                    simpleSynth.triggerAttackRelease("G4", "8n", "+0.1");
                    break;
                default: break;
            }
        }
        
        // === OBSLUHA UI A ZPR√ÅV ===
        // Funkce pro nastaven√≠ zamƒõ≈ôen√≠ na prvn√≠ interaktivn√≠ prvek v kontejneru
        function focusOnFirstInteractiveElement(container) {
            const firstElement = container.querySelector('button, a, input, [tabindex]:not([tabindex="-1"])');
            if (firstElement) {
                firstElement.focus();
            } else {
                // Pokud nen√≠ ≈æ√°dn√Ω interaktivn√≠ prvek, zamƒõ≈ô se na samotn√Ω kontejner
                container.focus();
            }
        }

        function showCustomModal(message, title = 'Zpr√°va', onConfirm = null, showCancel = false) {
            // Ulo≈æ√≠me si prvek, kter√Ω mƒõl zamƒõ≈ôen√≠ p≈ôed otev≈ôen√≠m mod√°ln√≠ho okna
            lastFocusedElement = document.activeElement;
            elements.modalMessageTitle.textContent = title;
            elements.modalMessage.innerHTML = message;
            elements.customMessageModal.style.display = 'flex';
            
            elements.modalOkButton.textContent = 'OK';
            elements.modalOkButton.onclick = () => {
                closeCustomModal();
                if (onConfirm) onConfirm();
            };
            
            elements.modalCancelButton.style.display = showCancel ? 'inline-block' : 'none';
            elements.modalCancelButton.onclick = closeCustomModal;

            // P≈ôesuneme zamƒõ≈ôen√≠ na mod√°ln√≠ okno a nastav√≠me ho na skryt√© pro odeƒç√≠taƒç, aby ho neƒçetl dvakr√°t
            elements.customMessageModal.focus();
            elements.customMessageModal.setAttribute('aria-hidden', 'false');
            document.addEventListener('keydown', handleModalKeyboard);
        }

        function closeCustomModal() {
            elements.customMessageModal.style.display = 'none';
            elements.customMessageModal.setAttribute('aria-hidden', 'true');
            document.removeEventListener('keydown', handleModalKeyboard);
            // Vr√°t√≠me zamƒõ≈ôen√≠ zpƒõt na prvek, kter√Ω ho mƒõl p≈ôed otev≈ôen√≠m okna
            if (lastFocusedElement) {
                lastFocusedElement.focus();
            }
        }

        function handleModalKeyboard(event) {
            if (event.key === 'Escape') {
                closeCustomModal();
            }
            // Zaji≈°≈•ujeme, ≈æe se zamƒõ≈ôen√≠ neztrat√≠, kdy≈æ stiskne≈° tab
            const focusableElements = elements.customMessageModal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            const firstFocusable = focusableElements[0];
            const lastFocusable = focusableElements[focusableElements.length - 1];
            if (event.key === 'Tab') {
                if (event.shiftKey) { // Zpƒõtn√Ω tab
                    if (document.activeElement === firstFocusable) {
                        lastFocusable.focus();
                        event.preventDefault();
                    }
                } else { // Norm√°ln√≠ tab
                    if (document.activeElement === lastFocusable) {
                        firstFocusable.focus();
                        event.preventDefault();
                    }
                }
            }
        }

        function showMessage(message, title = 'Nox ≈ô√≠k√°:') {
            showCustomModal(message, title);
        }

        function getRandomMessage(messages) {
            const randomIndex = Math.floor(Math.random() * messages.length);
            return messages[randomIndex];
        }

        // Vylep≈°en√° funkce pro p≈ôep√≠n√°n√≠ menu
        function toggleMenu(menuToShow, focusElementId = null) {
            const menus = [elements.startScreen, elements.gameStats, elements.foodMenu, elements.playMenu, elements.shopMenu, elements.firstAidKitMenu, elements.jobManagementMenu, elements.jobMenu];
            menus.forEach(menu => {
                if (menu === menuToShow) {
                    menu.classList.remove('hidden');
                    // Po zobrazen√≠ nov√©ho menu p≈ôesuneme zamƒõ≈ôen√≠ na prvn√≠ prvek
                    if (focusElementId) {
                        document.getElementById(focusElementId).focus();
                    } else {
                        focusOnFirstInteractiveElement(menu);
                    }
                } else {
                    menu.classList.add('hidden');
                }
            });
        }
        
        // === HLAVN√ç HERN√ç LOGIKA ===
        function updateStatsDisplay() {
            elements.hungerStatElem.textContent = `${nox.hunger}%`;
            elements.energyStatElem.textContent = `${nox.energy}%`;
            elements.hygieneStatElem.textContent = `${nox.hygiene}%`;
            elements.funStatElem.textContent = `${nox.fun}%`;
            elements.satisfactionStatElem.textContent = `${nox.satisfaction}%`;
            elements.weightStatElem.textContent = `${nox.weight.toFixed(2)} kg`;
            elements.currencyDisplay.textContent = `${nox.currency} Kredit≈Ø`;
            if (elements.shopCurrencyDisplay) elements.shopCurrencyDisplay.textContent = `${nox.currency}`;

            elements.hungerStatElem.className = `text-xl font-bold ${nox.hunger < 30 ? 'text-red-600' : (nox.hunger < 60 ? 'text-orange-500' : 'text-green-500')}`;
            elements.energyStatElem.className = `text-xl font-bold ${nox.energy < 30 ? 'text-red-600' : (nox.energy < 60 ? 'text-orange-500' : 'text-green-500')}`;
            elements.hygieneStatElem.className = `text-xl font-bold ${nox.hygiene < 30 ? 'text-red-600' : (nox.hygiene < 60 ? 'text-orange-500' : 'text-blue-500')}`;
            elements.funStatElem.className = `text-xl font-bold ${nox.fun < 30 ? 'text-red-600' : (nox.fun < 60 ? 'text-orange-500' : 'text-yellow-500')}`;
            elements.satisfactionStatElem.className = `text-xl font-bold ${nox.satisfaction < 25 ? 'text-red-600' : (nox.satisfaction < 50 ? 'text-orange-500' : (nox.satisfaction < 75 ? 'text-yellow-600' : 'text-purple-600'))}`;
            
            // Nov√Ω stav pro v√°hu
            elements.weightStatElem.className = `text-xl font-bold ${nox.weight > 10 || nox.weight < 3 ? 'text-red-600' : 'text-gray-700'}`;

            // --- P≈òIDAN√Å LOGIKA PRO ZOBRAZOV√ÅN√ç VAROV√ÅN√ç ---
            let currentWarning = null;
            if (nox.weight > 10) {
                currentWarning = 'overweight';
            } else if (nox.isSick) {
                currentWarning = 'sick';
            } else if (nox.isPoisoned) {
                currentWarning = 'poisoned';
            } else if (nox.weight < 3) {
                currentWarning = 'underweight';
            }

            if (currentWarning && currentWarning !== nox.lastWarning) {
                if (currentWarning === 'overweight') {
                     showCustomModal(noxMessages.overweight, "Nadv√°ha!");
                } else if (currentWarning === 'sick') {
                    elements.noxStatusElem.classList.remove('hidden');
                    elements.noxStatusElem.textContent = 'Nox je nemocn√Ω!';
                    elements.noxStatusElem.classList.add('sickness-text');
                    elements.noxStatusElem.classList.remove('poison-text');
                } else if (currentWarning === 'poisoned') {
                    elements.noxStatusElem.classList.remove('hidden');
                    elements.noxStatusElem.textContent = 'Nox m√° otravu z j√≠dla!';
                    elements.noxStatusElem.classList.add('poison-text');
                    elements.noxStatusElem.classList.remove('sickness-text');
                } else if (currentWarning === 'underweight') {
                    showCustomModal(noxMessages.underweight, "Podv√°ha!");
                }
                nox.lastWarning = currentWarning;
                playSound('warning');
            } else if (!currentWarning && nox.lastWarning) {
                 elements.noxStatusElem.classList.add('hidden');
                 elements.noxStatusElem.textContent = '';
                 elements.noxStatusElem.classList.remove('sickness-text', 'poison-text');
                 nox.lastWarning = null;
            }
            
            if (nox.isWorking) {
                elements.petNameDisplay.textContent = `${nox.currentJob.name} - zb√Ωv√° ${Math.floor(nox.workRemaining / 60)} min ${nox.workRemaining % 60} s`;
                disableAllActions();
            } else {
                elements.petNameDisplay.textContent = 'Nox';
                enableAllActions();
            }
        }
        
        function decreaseStats() {
            let decreaseRate = 0.5; // Upraveno, aby statistiky klesaly pomaleji

            if (nox.isSick || nox.isPoisoned) decreaseRate += 0.5;
            if (nox.weight > 10 || nox.weight < 3) decreaseRate += 0.25;

            nox.hunger = Math.max(0, nox.hunger - decreaseRate);
            nox.energy = Math.max(0, nox.energy - decreaseRate);
            nox.hygiene = Math.max(0, nox.hygiene - decreaseRate);
            nox.fun = Math.max(0, nox.fun - decreaseRate);
            nox.satisfaction = Math.max(0, nox.satisfaction - decreaseRate);
            nox.weight = Math.max(1, nox.weight - 0.05);

            updateStatsDisplay();

            if (nox.hunger === 0 || nox.energy === 0 || nox.hygiene === 0 || nox.fun === 0 || nox.satisfaction === 0) {
                endGame();
            } else {
                if (nox.hunger < 20 || nox.energy < 20 || nox.hygiene < 20 || nox.fun < 20) {
                    // showMessage(noxMessages.lowStats);
                    // playSound('warning');
                } else if (nox.satisfaction < 30) {
                    // showMessage(noxMessages.lowSatisfaction);
                    // playSound('grumpy');
                }
            }
        }
        
        function endGame() {
            clearInterval(gameInterval);
            clearInterval(autoSaveInterval);
            showCustomModal(`Ach ne! Nox u≈æ nem√° s√≠lu. Hra skonƒçila. Zkus to znovu!`, 'Konec hry');  
            playSound('gameOver');
            elements.startGameButton.textContent = 'Hr√°t znovu!';
            toggleMenu(elements.startScreen);
            
            // Resetov√°n√≠ stavu hry
            nox = { 
                hunger: 100, 
                energy: 100, 
                hygiene: 100, 
                fun: 100, 
                satisfaction: 100, 
                weight: 5, 
                currency: 100,
                isSick: false,
                isPoisoned: false,
                playCount: 0,
                bathCount: 0,
                lastFood: null,
                sameFoodCount: 0,
                inventory: [],
                currentJob: null,
                isWorking: false,
                workTimer: null,
                workRemaining: 0,
                lastWarning: null
            };
            
            localStorage.removeItem('noxSave');
            updateStatsDisplay();
        }

        function startGame() {
            toggleMenu(elements.gameStats);
            elements.petNameDisplay.textContent = 'Nox';
            showMessage('V√≠tej. Tv≈Øj Nox je p≈ôipraven na dobrodru≈æstv√≠.');
            updateStatsDisplay();
            
            if (gameInterval) clearInterval(gameInterval);
            if (autoSaveInterval) clearInterval(autoSaveInterval);

            gameInterval = setInterval(decreaseStats, 60000);
            autoSaveInterval = setInterval(saveGameToLocalStorage, AUTOSAVE_INTERVAL * 1000);
        }

        // === AKCE A INTERAKCE ===
        function applyEffects(effects) {
            if (effects.hunger !== undefined) nox.hunger = Math.min(100, Math.max(0, nox.hunger + effects.hunger));
            if (effects.energy !== undefined) nox.energy = Math.min(100, Math.max(0, nox.energy + effects.energy));
            if (effects.hygiene !== undefined) nox.hygiene = Math.min(100, Math.max(0, nox.hygiene + effects.hygiene));
            if (effects.fun !== undefined) nox.fun = Math.min(100, Math.max(0, nox.fun + effects.fun));
            if (effects.satisfaction !== undefined) nox.satisfaction = Math.min(100, Math.max(0, nox.satisfaction + effects.satisfaction));
            if (effects.weight !== undefined) nox.weight = Math.max(1, nox.weight + effects.weight);
            updateStatsDisplay();
        }
        
        function applyFoodEffects(food) {
            if (nox.lastFood === food.name) {
                nox.sameFoodCount++;
                if (nox.sameFoodCount >= 5) {
                    nox.isPoisoned = true;
                    showCustomModal("Noxovi je zle! Ode≈°el od misky a pozvracel se. Pot≈ôebuje≈° l√©k Noxotronik z l√©k√°rniƒçky!", "Nox m√° otravu!");
                }
            } else {
                nox.sameFoodCount = 1;
                nox.lastFood = food.name;
            }
            
            applyEffects(food.effects);
            updateStatsDisplay();

            let message;
            if (nox.hunger <= 30) {
                message = getRandomMessage(food.messages.low);
            } else if (nox.hunger >= 90) {
                message = getRandomMessage(food.messages.high);
            } else {
                message = getRandomMessage(food.messages.mid);
            }
            showMessage(message);
            
            if (food.name === "Va≈ôen√° zelenina" || food.name === "Pivo") {
                playSound('badFood');
            } else {
                playSound('eating');
            }
            toggleMenu(elements.gameStats);
        }

        function showFoodMenu() {
            toggleMenu(elements.foodMenu, 'foodMenuTitle');
            elements.foodOptionsContainer.innerHTML = '';

            foodItems.forEach(food => {
                const button = document.createElement('button');
                button.textContent = food.name;
                button.className = 'bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-xl shadow-sm transition duration-300 ease-in-out transform hover:scale-105';
                button.addEventListener('click', () => {
                    applyFoodEffects(food);
                });
                elements.foodOptionsContainer.appendChild(button);
            });
        }

        function applyPlayEffects(activity) {
            if (activity.name === "J√≠t si hr√°t ven" || activity.name === "J√≠t na proch√°zku" || activity.name === "Aportovat") {
                nox.playCount++;
                if (nox.playCount >= 5) {
                    nox.isSick = true;
                    showCustomModal("Nox je nachlazen√Ω! Neust√°l√© hran√≠ venku mu nedƒõl√° dob≈ôe. Pot≈ôebuje≈° l√©k Noxolit z l√©k√°rniƒçky!", "Nox je nemocn√Ω!");
                }
            } else {
                nox.playCount = 0;
            }
            
            applyEffects(activity.effects);

            showMessage(activity.message);
            playSound('activity');
            toggleMenu(elements.gameStats);
        }

        function showPlayMenu() {
            toggleMenu(elements.playMenu, 'playMenuTitle');
            elements.playOptionsContainer.innerHTML = '';

            playItems.forEach(activity => {
                const button = document.createElement('button');
                button.textContent = activity.name;
                button.className = 'bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-xl shadow-sm transition duration-300 ease-in-out transform hover:scale-105';
                button.addEventListener('click', () => {
                    applyPlayEffects(activity);
                });
                elements.playOptionsContainer.appendChild(button);
            });
        }
        
        function batheNox() {
            nox.hygiene = Math.min(100, nox.hygiene + 25);
            nox.fun = Math.min(100, nox.fun + 5);
            nox.satisfaction = Math.min(100, nox.satisfaction + 10);
            updateStatsDisplay();
            showMessage(getRandomMessage(noxMessages.bath));
            playSound('action');
        }

        function sleepNox() {
            let message;
            let soundType = 'action';
            
            if (nox.energy >= 90) {
                message = getRandomMessage(noxMessages.sleep.high);
                nox.satisfaction = Math.max(0, nox.satisfaction - 5);
                soundType = 'grumpy';
            } else if (nox.energy >= 50) {
                message = getRandomMessage(noxMessages.sleep.mid);
                nox.energy = Math.min(100, nox.energy + 30);
                nox.hunger = Math.max(0, nox.hunger - 10);
                nox.satisfaction = Math.min(100, nox.satisfaction + 15);
                soundType = 'sleeping';
            } else {
                message = getRandomMessage(noxMessages.sleep.low);
                nox.energy = Math.min(100, nox.energy + 50);
                nox.hunger = Math.max(0, nox.hunger - 15);
                nox.satisfaction = Math.min(100, nox.satisfaction + 25);
                soundType = 'sleeping';
            }

            updateStatsDisplay();
            showMessage(message);
            playSound(soundType);
        }
        
        function talkToNox() {
            let message;
            const avgStat = (nox.hunger + nox.energy + nox.hygiene) / 3;
            if (avgStat <= 30) {
                message = getRandomMessage(noxMessages.talk.howAreYou.low);
            } else if (avgStat <= 90) {
                message = getRandomMessage(noxMessages.talk.howAreYou.mid);
            } else {
                message = getRandomMessage(noxMessages.talk.howAreYou.high);
            }
            showCustomModal(message, 'Nox odpov√≠d√°');
        }

        function openShop() {
            toggleMenu(elements.shopMenu, 'shopMenuTitle');
            elements.shopCurrencyDisplay.textContent = `${nox.currency}`;
            renderShopItems();
        }

        function buyItem(item) {
            if (nox.currency >= item.price) {
                nox.currency -= item.price;
                
                if (item.type === "medicine" || item.type === "potion") {
                    nox.inventory.push(item);
                    showMessage(`Koupil jsi ${item.name} za ${item.price} Kredit≈Ø a ulo≈æil jej do l√©k√°rniƒçky.`);
                } else {
                    applyEffects(item.effects);
                    showMessage(item.message);
                }
                
                updateStatsDisplay();
                toggleMenu(elements.gameStats);
            } else {
                showCustomModal(`Nem√°≈° dostatek Kredit≈Ø na n√°kup ${item.name}. Pot≈ôebuje≈° ${item.price} Kredit≈Ø, ale m√°≈° jen ${nox.currency}.`, "Nedostatek Kredit≈Ø");
            }
        }

        function renderShopItems() {
            elements.shopItemsContainer.innerHTML = '';
            
            shopItems.forEach(item => {
                const button = document.createElement('button');
                button.textContent = item.name;
                button.className = 'bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-xl shadow-sm transition duration-300 ease-in-out transform hover:scale-105';
                button.addEventListener('click', () => {
                    buyItem(item);
                });
                elements.shopItemsContainer.appendChild(button);
            });
        }
        
        function openFirstAidKit() {
            toggleMenu(elements.firstAidKitMenu, 'firstAidKitMenuTitle');
            renderFirstAidKitItems();
        }

        function useItemFromInventory(item, index) {
            switch (item.name) {
                case "Nomax":
                    nox.hunger = 100;
                    nox.energy = 100;
                    nox.hygiene = 100;
                    nox.fun = 100;
                    nox.satisfaction = 100;
                    break;
                case "Noxofit":
                    nox.weight = 5;
                    break;
                case "Noxolit":
                    nox.isSick = false;
                    break;
                case "Noxotronik":
                    nox.isPoisoned = false;
                    break;
            }

            nox.inventory.splice(index, 1);
            updateStatsDisplay();
            showMessage(item.message);
            renderFirstAidKitItems();
            toggleMenu(elements.gameStats);
        }

        function renderFirstAidKitItems() {
            elements.firstAidKitItemsContainer.innerHTML = '';
            if (nox.inventory.length === 0) {
                elements.firstAidKitItemsContainer.innerHTML = '<p class="text-gray-600">L√©k√°rniƒçka je pr√°zdn√°.</p>';
            } else {
                nox.inventory.forEach((item, index) => {
                    const button = document.createElement('button');
                    button.textContent = item.name;
                    button.className = 'bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-xl shadow-sm transition duration-300 ease-in-out transform hover:scale-105';
                    button.addEventListener('click', () => {
                        useItemFromInventory(item, index);
                    });
                    elements.firstAidKitItemsContainer.appendChild(button);
                });
            }
        }
        
        // === ZAMƒöSTN√ÅN√ç ===
        function disableAllActions() {
            const buttons = document.querySelectorAll('#gameStats button');
            buttons.forEach(btn => btn.disabled = true);
        }

        function enableAllActions() {
            const buttons = document.querySelectorAll('#gameStats button');
            buttons.forEach(btn => btn.disabled = false);
        }
        
        function openJobManagementMenu() {
            toggleMenu(elements.jobManagementMenu, 'jobManagementTitle');
            renderJobList();
        }
        
        function renderJobList() {
            elements.jobListContainer.innerHTML = '';
            if (nox.currentJob) {
                elements.currentJobText.textContent = `Noxovo aktu√°ln√≠ zamƒõstn√°n√≠: ${nox.currentJob.name}`;
            } else {
                elements.currentJobText.textContent = `Nox je nezamƒõstnan√Ω.`;
            }
            
            for (const jobName in jobsConfig) {
                const job = jobsConfig[jobName];
                const jobDiv = document.createElement('div');
                jobDiv.classList.add('job-item');
                jobDiv.innerHTML = `
                    <h4>${job.name}</h4>
                    <p>${job.description}</p>
                    <p>Trv√°n√≠: ${job.duration / 60} minut | Plat: ${job.reward} Kredit≈Ø</p>
                    <button class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-xl mt-2" data-job-name="${job.name}">Vybrat</button>
                `;
                elements.jobListContainer.appendChild(jobDiv);
            }
        }
        
        // P≈ôid√°n event listener na kontejner pro delegaci ud√°lost√≠
        elements.jobListContainer.addEventListener('click', (event) => {
            const button = event.target.closest('button');
            if (button && button.dataset.jobName) {
                setJob(button.dataset.jobName);
            }
        });

        function setJob(jobName) {
            nox.currentJob = jobsConfig[jobName];
            showMessage(`Ahoj p√°n√≠ƒçku, tak jsem ${nox.currentJob.name}! M≈Ø≈æe≈° mƒõ poslat do pr√°ce.`);
            toggleMenu(elements.gameStats);
            updateJobMenu();
        }

        function openJobMenu() {
            toggleMenu(elements.jobMenu, 'jobMenuTitle');
            updateJobMenu();
        }

        function updateJobMenu() {
            if (nox.currentJob) {
                elements.jobDescriptionText.innerHTML = `${nox.currentJob.name}: ${nox.currentJob.description}<br>Trv√°n√≠: ${nox.currentJob.duration / 60} minut, Odmƒõna: ${nox.currentJob.reward} Kredit≈Ø.`;
                elements.startJobButton.classList.remove('hidden');
            } else {
                elements.jobDescriptionText.textContent = `Nox je moment√°lnƒõ nezamƒõstnan√Ω. Vyber mu pr√°ci ve Spr√°vƒõ zamƒõstn√°n√≠.`;
                elements.startJobButton.classList.add('hidden');
            }
        }

        function startJob() {
            if (!nox.currentJob) {
                showCustomModal('Nejprve mus√≠≈° Noxovi vybrat zamƒõstn√°n√≠!', 'Chyba');
                return;
            }
            nox.isWorking = true;
            nox.workRemaining = nox.currentJob.duration;
            showMessage(`Ode≈°el jsem do pr√°ce na pozici ${nox.currentJob.name}. Ahoj!`);
            updateStatsDisplay();
            nox.workTimer = setInterval(updateWorkTimer, 1000);
            toggleMenu(elements.gameStats);
        }

        function updateWorkTimer() {
            if (nox.isWorking) {
                nox.workRemaining--;
                updateStatsDisplay();
            }
            if (nox.workRemaining <= 0) {
                clearInterval(nox.workTimer);
                finishJob();
            }
        }

        function finishJob() {
            nox.isWorking = false;
            nox.currency += nox.currentJob.reward;
            nox.energy = Math.max(0, nox.energy - 30);
            nox.hunger = Math.max(0, nox.hunger - 20);
            nox.hygiene = Math.max(0, nox.hygiene - 10);
            nox.fun = Math.min(100, nox.fun + 10);
            nox.satisfaction = Math.min(100, nox.satisfaction + 20);
            
            const jobMessage = getRandomMessage(nox.currentJob.messages);
            
            showCustomModal(`Vr√°til jsem se z pr√°ce, a p≈ôinesl jsem ti ${nox.currentJob.reward} Kredit≈Ø.<br><br>"${jobMessage}"`, 'Pr√°ce dokonƒçena!');
            playSound('jobDone');
            updateStatsDisplay();
        }

        // === UKL√ÅD√ÅN√ç A NAƒå√çT√ÅN√ç ===
        function saveGameToLocalStorage() {
            try {
                localStorage.setItem('noxSave', JSON.stringify(nox));
                console.log('Hra ulo≈æena do lok√°ln√≠ho √∫lo≈æi≈°tƒõ.');
            } catch (e) {
                console.error("Chyba p≈ôi ukl√°d√°n√≠ hry:", e);
            }
        }

        function loadGameFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('noxSave');
                if (savedData) {
                    const loadedNox = JSON.parse(savedData);
                    if (loadedNox) {
                        Object.assign(nox, loadedNox);
                        return true;
                    }
                }
            } catch (e) {
                console.error("Chyba p≈ôi naƒç√≠t√°n√≠ hry z lok√°ln√≠ho √∫lo≈æi≈°tƒõ:", e);
            }
            return false;
        }

        function exportGame() {
            try {
                const noxData = JSON.stringify(nox, null, 2);
                const blob = new Blob([noxData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'nox_save.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showCustomModal('Hra exportov√°na do souboru nox_save.json!', 'Ulo≈æeno');
                playSound('saveLoad');
            } catch (e) {
                showCustomModal('Chyba p≈ôi exportu hry: ' + e.message, 'Chyba');
                console.error("Chyba p≈ôi exportu hry:", e);
            }
        }

        function importGame() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.json';
            fileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const loadedNox = JSON.parse(e.target.result);
                            if (loadedNox && typeof loadedNox.hunger === 'number' && typeof loadedNox.energy === 'number') {
                                Object.assign(nox, loadedNox);
                                updateStatsDisplay();
                                showCustomModal('Hra naƒçtena √∫spƒõ≈°nƒõ ze souboru!', 'Naƒçteno');
                                playSound('saveLoad');
                                if (gameInterval) clearInterval(gameInterval);
                                if (autoSaveInterval) clearInterval(autoSaveInterval);
                                gameInterval = setInterval(decreaseStats, 60000);
                                autoSaveInterval = setInterval(saveGameToLocalStorage, AUTOSAVE_INTERVAL * 1000);
                                toggleMenu(elements.gameStats);
                            } else {
                                showCustomModal('Chyba: Soubor neobsahuje platn√° data hry Nox.', 'Chyba');
                                playSound('badFood');
                            }
                        } catch (parseError) {
                            showCustomModal('Chyba p≈ôi ƒçten√≠ souboru: ' + parseError.message, 'Chyba');
                            console.error("Chyba p≈ôi parsov√°n√≠ JSON souboru:", parseError);
                            playSound('badFood');
                        }
                    };
                    reader.onerror = (readerError) => {
                        showCustomModal('Chyba p≈ôi ƒçten√≠ souboru: ' + readerError.message, 'Chyba');
                        console.error("Chyba FileReaderu:", readerError);
                        playSound('badFood');
                    };
                    reader.readAsText(file);
                } else {
                    showCustomModal('≈Ω√°dn√Ω soubor nebyl vybr√°n.', 'Chyba');
                }
            });
            fileInput.click();
        }

        // === P≈ò√çPRAVA HRY P≈òI NAƒåTEN√ç STR√ÅNKY ===
        function init() {
            const savedGameExists = loadGameFromLocalStorage();
            if (savedGameExists) {
                toggleMenu(elements.gameStats);
                startGame();
            } else {
                toggleMenu(elements.startScreen);
            }
        }

        // === P≈òID√ÅN√ç EVENT LISTENER≈Æ ===
        elements.startGameButton.addEventListener('click', () => {
            // Kontrola, zda existuje ulo≈æen√° hra, a dotaz na u≈æivatele
            if (localStorage.getItem('noxSave')) {
                showCustomModal('Na≈°lo se ulo≈æen√° hra. Chce≈° ji nahr√°t?', 'Naƒç√≠st hru?', () => {
                    loadGameFromLocalStorage();
                    startGame();
                }, true);
            } else {
                startGame();
            }
        });
        elements.feedButton.addEventListener('click', showFoodMenu);
        elements.batheButton.addEventListener('click', batheNox);
        elements.sleepButton.addEventListener('click', sleepNox);
        elements.playButton.addEventListener('click', showPlayMenu);
        elements.talkButton.addEventListener('click', talkToNox);
        elements.shopButton.addEventListener('click', openShop);
        elements.firstAidKitButton.addEventListener('click', openFirstAidKit);
        elements.jobManagementButton.addEventListener('click', openJobManagementMenu);
        elements.jobButton.addEventListener('click', openJobMenu);
        elements.startJobButton.addEventListener('click', startJob);
        elements.saveGameButton.addEventListener('click', exportGame);
        elements.loadGameButton.addEventListener('click', importGame);
        elements.showStoryButton.addEventListener('click', () => {
            showCustomModal(document.getElementById('introScreen').innerHTML, 'P≈ô√≠bƒõh Noxe');
        });

        // Tlaƒç√≠tka pro zav√≠r√°n√≠ menu s p≈ôesunem zamƒõ≈ôen√≠ zpƒõt na hlavn√≠ menu
        elements.closeFoodMenuButton.addEventListener('click', () => toggleMenu(elements.gameStats));
        elements.closePlayMenuButton.addEventListener('click', () => toggleMenu(elements.gameStats));
        elements.closeShopMenuButton.addEventListener('click', () => toggleMenu(elements.gameStats));
        elements.closeFirstAidKitButton.addEventListener('click', () => toggleMenu(elements.gameStats));
        elements.closeJobManagementMenuButton.addEventListener('click', () => toggleMenu(elements.gameStats));
        elements.closeJobMenuButton.addEventListener('click', () => toggleMenu(elements.gameStats));
        
        // Funkce pro obnoven√≠ zamƒõ≈ôen√≠ na startovac√≠ tlaƒç√≠tko po naƒçten√≠ str√°nky
        window.addEventListener('load', () => {
            const savedGameExists = loadGameFromLocalStorage();
            if (!savedGameExists) {
                elements.startGameButton.focus();
            } else {
                elements.feedButton.focus(); // Zamƒõ≈ô se na prvn√≠ hern√≠ tlaƒç√≠tko
            }
        });
        
        // Spu≈°tƒõn√≠ inicializaƒçn√≠ funkce po naƒçten√≠ str√°nky
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>